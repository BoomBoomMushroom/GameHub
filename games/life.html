<div id="settings">
  <div id="colors">
    <p>Colors</p>
    
    <div id="red">
      <strong>Red</strong>
      <input type="number" id="redNum" min="0" max="1000" value="0">
    </div>
    <div id="orange">
      <strong>Orange</strong>
      <input type="number" id="orangeNum" min="0" max="1000" value="0">
    </div>
    <div id="yellow">
      <strong>Yellow</strong>
      <input type="number" id="yellowNum" min="0" max="1000" value="0">
    </div>
    <div id="green">
      <strong>Green</strong>
      <input type="number" id="greenNum" min="0" max="1000" value="0">
    </div>
    <div id="blue">
      <strong>Blue</strong>
      <input type="number" id="blueNum" min="0" max="1000" value="0">
    </div>
    <div id="purple">
      <strong>Purple</strong>
      <input type="number" id="purpleNum" min="0" max="1000" value="0">
    </div>
    <div id="pink">
      <strong>Pink</strong>
      <input type="number" id="pinkNum" min="0" max="1000" value="0">
    </div>
    <div id="white">
      <strong>White</strong>
      <input type="number" id="whiteNum" min="0" max="1000" value="0">
    </div>
    <button onclick="regenerate()"><strong>Recreate</strong></button>
    
  </div>
  <div id="rules">
    <span>Rules: <strong id="ruleCount">0</strong></span>
    <br>
    <span>Click to delete</span>
    <br>
    
    <div id="rulesHolder">
      
    </div>
    
    <button onclick="createRule()"><strong>+</strong></button>
  </div>
</div>

<canvas id="life"></canvas>

<style>
  input{
    width: 40px;
  }
  #settings{
    position: relative;
    top: 0px;
    left: 0px;
    width: 60%;
  }
  #colors{
    position: relative;
    top: 50%;
    left: 0px;
    height: 50%;
    width: 30%;
    border: 1px solid black;
    overflow: scroll;
  }
  #rules{
    position: relative;
    bottom: 50%;
    left: 0px;
    height: 50%;
    width: 30%;
    border: 1px solid black;
    overflow: scroll;
  }
  #life{
    position: absolute;
    right: 0px;
    top: 0px;
  }
</style>

<script>
const widthMultiplier = 0.8

var width = window.innerWidth * widthMultiplier
var height = window.innerHeight

document.getElementById("life").width = width
document.getElementById("life").height = height

const rules = []
const ld_rules = []

m=document.getElementById("life").getContext("2d")

draw=(x,y,c,s)=>{
	m.fillStyle=c
  m.fillRect(x,y,s,s)
}

particles=[]
particle=(x,y,c)=>{
	return{"x":x,"y":y,"vx":0,"vy":0,"color":c}
}

random=()=>{
	return Math.random()*(height-50)+50
}

create=(number,color)=>{
	group=[]
  for(let i=0;i<number;i++){
  	group.push(particle(random(),random(),color))
    particles.push(group[i])
  }
  return group
}

rule=(particles1,particles2,g)=>{
	for(let i=0;i<particles1.length;i++){
  	fx = 0
  	fy = 0
  	for(let j=0;j<particles2.length;j++){
      a = particles1[i]
      b = particles2[j]
      dx = a.x-b.x
      dy = a.y-b.y
      d = Math.sqrt(dx*dx+dy*dy)
      if(d > 0 && d < 80){
        F = g * 1/d
        fx += (F*dx)
        fy += (F*dy)
      }
    }

    a.vx = (a.vx+fx)*0.5
    a.vy = (a.vy+fy)*0.5
    a.x += a.vx
    a.y += a.vy
    if(a.x<=0||a.x>=width){a.vx *=-1}
  	if(a.y<=0||a.y>=height){a.vy *=-1}
	}
}

function isCollide(a, b) {
    if (a.x + 5 >= b.x &&    // r1 right edge past r2 left
      a.x <= b.x + 5 &&    // r1 left edge past r2 right
      a.y + 5 >= b.y &&    // r1 top edge past r2 bottom
      a.y <= b.y + 5) {    // r1 bottom edge past r2 top
        return true;
  }
  return false;
}

function collideGroup(a,g){
	for(var i=0;i<g.length;i++){
  	if(isCollide(a,g[i]) && a != g[i]){
    	return g[i]
    }
  }
  return -1
}

ld_rule=(particles1,particles2,ld)=>{
	for(var i=0;i<particles1.length;i++){
  	var c = collideGroup(particles1[i],particles2)
    var a = particles1[i]
    var b = {...c}
    if(c != -1){
    	if(ld && particles2.length < 750){
      	getColor(a.color).push(particle(random(),random(),a.color))
        //getColor(b.color).push(particle(random(),random(),b.color))
        //getColor(a.color).push(particle(random(),random(),a.color))
        
        //getColor(a.color).splice(i,1)
        //getColor(b.color).splice(c,1)
      }
      else if(ld==false){
      	getColor(a.color).splice(i,1)
      }
    }
  }
}

var red = create(document.getElementById("redNum").value,"red")
var orange = create(document.getElementById("orangeNum").value,"orange")
var yellow = create(document.getElementById("yellowNum").value,"yellow")
var green = create(document.getElementById("greenNum").value,"green")
var blue = create(document.getElementById("blueNum").value,"blue")
var purple = create(document.getElementById("purpleNum").value,"purple")
var pink = create(document.getElementById("pinkNum").value,"pink")
var white = create(document.getElementById("whiteNum").value,"white")

function regenerate(){
	particles = []
	red = create(document.getElementById("redNum").value,"red")
  orange = create(document.getElementById("orangeNum").value,"orange")
  yellow = create(document.getElementById("yellowNum").value,"yellow")
  green = create(document.getElementById("greenNum").value,"green")
  blue = create(document.getElementById("blueNum").value,"blue")
  purple = create(document.getElementById("purpleNum").value,"purple")
  pink = create(document.getElementById("pinkNum").value,"pink")
  white = create(document.getElementById("whiteNum").value,"white")
}
function getColor(str){
	var allColors="red orange yellow green blue purple pink white"
  if(allColors.includes(str)){
  	if(str=="red"){return red}
  	if(str=="orange"){return orange}
  	if(str=="yellow"){return yellow}
  	if(str=="green"){return green}
  	if(str=="blue"){return blue}
  	if(str=="purple"){return purple}
  	if(str=="pink"){return pink}
  	if(str=="white"){return white}
  }
}

function createRule(){
	var allColors="red orange yellow green blue purple pink white"
  var color1 = prompt("Type the color that will have motion")
  var color2 = prompt("Type the color that will affect the motion")
  var gravity = parseFloat(prompt("Gravity amount ( -1 to 1) (negitive to attract) (Put 0 to add a life/death rule)"))
  if(allColors.includes(color1) && allColors.includes(color2) && !isNaN(gravity)){
  	if(gravity==0){
    	var isLife = confirm("select 'OK' for life rule and 'Cancel' for death rule")
      var t = "Death"
      if(isLife){t="Life"}
      ld_rules.push([color1,color2,isLife])
      var r = document.createElement("button")
      var oc = "deleteRule('"+color1+"','"+color2+"',"+isLife+")"
      r.id = color1+", "+color2+", 0, "+t
      r.onclick = ()=>{
        deleteRule(color1,color2,0,isLife);
        document.getElementById(color1+", "+color2+", 0, "+t).remove()
      }
      r.innerHTML = color1+", "+color2+", "+t
      document.getElementById("rulesHolder").appendChild(r)
      document.getElementById("ruleCount").innerText = rules.length+ld_rules.length
      return
    }
  	
  	rules.push([color1,color2,gravity])
    var r = document.createElement("button")
    var oc = "deleteRule('"+color1+"','"+color2+"',"+gravity+")"
    r.id = color1+", "+color2+", "+gravity
    r.onclick = ()=>{
    	deleteRule(color1,color2,gravity);
      document.getElementById(color1+", "+color2+", "+gravity).remove()
    }
    r.innerHTML = color1+", "+color2+", "+gravity
    document.getElementById("rulesHolder").appendChild(r)
    document.getElementById("ruleCount").innerText = rules.length+ld_rules.length
  }
}
function deleteRule(c1,c2,g,l){
	if(g==0){
  	var r2 = [c1,c2,l]
    for(var i=0;i<ld_rules.length;i++){
      var r = ld_rules[i]
      if(r[0]==r2[0]&&r[1]==r2[1]&&r[2]==r2[2]){
        ld_rules.splice(i,1)
      }
    }
    document.getElementById("ruleCount").innerText = rules.length+ld_rules.length
  	return
  }

  var r2 = [c1,c2,g]
  for(var i=0;i<rules.length;i++){
  	var r = rules[i]
    if(r[0]==r2[0]&&r[1]==r2[1]&&r[2]==r2[2]){
    	rules.splice(i,1)
    }
	}
  document.getElementById("ruleCount").innerText = rules.length+ld_rules.length
}

function renderParticles(p){
	for(var i=0;i<p.length;i++){
  	draw(p[i].x,p[i].y,p[i].color,5)
  }
}

update=()=>{
	for(var i=0;i<rules.length;i++){
  	var r = rules[i]
    rule(getColor(r[0]),getColor(r[1]),r[2])
  }
  for(var i=0;i<ld_rules.length;i++){
  	var r = ld_rules[i]
    ld_rule(getColor(r[0]),getColor(r[1]),r[2])
  }
  
	m.clearRect(0,0,width,height)
  draw(0,0,"black",width*height)
  renderParticles(red)
  renderParticles(orange)
  renderParticles(yellow)
  renderParticles(green)
  renderParticles(blue)
  renderParticles(purple)
  renderParticles(pink)
  renderParticles(white)
  requestAnimationFrame(update)
}

update()
</script>
