<link rel="icon" href="GamesHubLogo.png">

<canvas id="warzone" width=300 height=300 style="border:1px solid black" onclick="shoot()"></canvas>

<h1 id="welcome">Welcome to GamesHub!</h1>

<style>
	body{
		background-image: url("https://raw.githubusercontent.com/BoomBoomMushroom/GameHub/main/GamehubApi/images/GH_Background.png");
		background-repeat: repeat-y;
  		background-size: cover;
	}
</style>

<!-- Line break every 10 games -->

<style>
.dropbtn {
  background-color: #3ba1db;
  color: white;
  padding: 16px;
  font-size: 16px;
  border: none;
}

.dropdown {
  position: relative;
  display: inline-block;
  width: 10%;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #343635;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

.dropdown-content a:hover {background-color: #ddd;}

.dropdown:hover .dropdown-content {display: block;}

.dropdown:hover .dropbtn {background-color: #3e8e41;}
</style>

<div class="dropdown" id="SinglePlayer">
  <button class="dropbtn">Single Player Games</button>
  <div class="dropdown-content">
	<div>
	    	<a href="https://gameshub.dev/snake">Snake</a>
	    	<a href="https://pet-the-dog.netlify.app/">Pet the Dog!</a>
	    	<a href="https://gameshub.dev/solarsystemsimulator">Solar System Simulator</a>
	    	<a href="https://custom-programming-language-creator.netlify.app">Custom Programming Language Crearor</a>
	    	<a href="https://gameshub.dev/market">Market Simulator</a>
	    	<a href="https://gameshub.dev/monpoke">Monpoke</a>
	    	<a href="http://gameshub.dev/pageCounter">Page Counter</a>
	    	<a href="https://gameshub.dev/snakeAiBattle">You v.s Snake AI</a>
	    	<a href="https://gameshub.dev/snakeEcosystem">Snake based Ecosystem</a>
		<a href="https://gameshub.dev/existance">Existance Simulator</a>
	</div>
	<div>
		<a href="https://gameshub.dev/RaycastingTest">Pseudo 3D World -- Raycasting Test</a>
	    	<a href='https://gameshub.dev/appleCollection'>The Apple Collection</a>
	    	<a href="http://gameshub.dev/pageCounter3D">Page Counter 3D</a>
	    	<a href="http://gameshub.dev/stolenCode/pokemonEmulators">Pokemon Emulator</a>
	    	<a href="http://gameshub.dev/cicada_rpg/index">Cicada Collection</a>
	    	<a href="http://gameshub.dev/pixelArtMaker">Pixel Art Maker</a>
	    	<a href="http://gameshub.dev/snake_ai-v2">Snake AI 2</a>
	    	<a href="http://gameshub.dev/conways_game_of_life">Conway's Game Of Life</a>
	    	<a href="https://gameshub.dev/LogicCreator">Logic Gate Creator</a>
	    	<a href='https://gameshub.dev/SlayingSnowballs'>Slaying Snowballs</a>  
	</div>
	<div>
		<a href="https://gameshub.dev/wordle">Wordle Copy Old</a>
	    	<a href='https://gameshub.dev/wordleNew'>Wordle Copy</a>
	    	<a href='https://gameshub.dev/wordleSolver'>Wordle Solver</a>
		<a href='https://gameshub.dev/place'>Gameshub Place</a>
		<a href='https://gameshub.dev/placeHolder'></a>
	</div>
	<div></div>
	<div></div>
	<div></div>
	<div></div>
	<div></div>
	<div></div>
	<div></div>
  </div>
</div>

<br>
<br>

<div class="dropdown" id="MultiPlayer">
  <button class="dropbtn">Multiplayer Games</button>
  <div class="dropdown-content">
    <a href='https://gameshub.dev/ExistanceSimulator1D'>Existance Simulator 1D - Multiplayer</a>
    <a href='https://gameshub.dev/existanceSimulator'>Existance Simulator 2D - Multiplayer</a>
    <a href='https://gameshub.dev/ExistanceSimulator3D'>Existance Simulator 3D - Multiplayer</a>
  </div>
</div>

<br>
<br>

<div class="dropdown" id="HolidayGames">
  <button class="dropbtn">Holiday Games</button>
  <div class="dropdown-content">
  </div>
</div>

<br>
<br>

<div class="dropdown" id="DevBuilds">
  <button class="dropbtn">Dev-Build / Testing Builds of games</button>
  <div class="dropdown-content">
    <a href='https://gameshub.dev/movement3dTest'>THREE js movement build</a>
  </div>
</div>

<br>
<br>


<p>Links</p>
<a href='https://github.com/Academy-of-Code/GameHub'>Gameshub source code here</a>
<br>
<a disabled href='https://api.gameshub.dev'>API: api.gameshub.dev</a>
<br>
<a href="" id="currentAcc"></a>
<br>
<button id="logout" onclick="setCookie('accToken','',365*10);location.reload()" id="currentAcc">Logout</button>
<br>
<a id='tr1' href="https://gameshub.dev/gamehubapi/signup"><button id="signupButton" style="top:10px;right:10px;width:70px;">Signup</button></a>
<br>
<a id='tr2' href="https://gameshub.dev/gamehubapi/signin"><button id="loginButton" style="top:35px;right:10px;width:70px;">Log in</button></a>
<br>
<a id='tr3' href="https://gameshub.dev/gamehubapi/accsearch"><button id="accSearchButton" style="top:60px;right:10px;width:70px;">Search Accounts</button></a>

<script>
paragraphs = document.getElementsByTagName("p")
header1s = document.getElementsByTagName("h1")
links = document.getElementsByTagName("a")
labels = document.getElementsByTagName("label")

//document.body.style.background = darkmodeColor
for(var x=0;x<paragraphs.length;x++){
	para = paragraphs[x]
	para.style.color = "#ffffff"
	// para.classList.add("darkmode_text")
}
for(var x=0;x<header1s.length;x++){
	h1 = header1s[x]
	h1.style.color = "#ffffff"
	// para.classList.add("darkmode_text")
}
for(var x=0;x<links.length;x++){
	link = links[x]
	link.style.color = "#ffffff"
	// para.classList.add("darkmode_text")
}
for(var x=0;x<labels.length;x++){
	lab = labels[x]
	lab.style.color = "#ffffff"
	// para.classList.add("darkmode_text")
}
setInterval(()=>{
	modeEnable()
},50)
</script>

<script>
	function setCookie(cname, cvalue, exdays){
	  const d = new Date();
	  d.setTime(d.getTime() + (exdays*24*60*60*1000));
	  let expires = "expires="+d.toUTCString();
	  document.cookie = cname+"="+cvalue+";"+expires+";path=/";
	}
	function getCookie(cname){
	  let name = cname + "=";
	  let decodedCookie = decodeURIComponent(document.cookie);
	  let ca = decodedCookie.split(';');
	  for (let i=0; i<ca.length;i++){
		let c = ca[i];
	    while (c.charAt(0)==' '){
		c = c.substring(1);
	    }
	    if(c.indexOf(name)==0){
		return c.substring(name.length,c.length);
	    }
	  }
	  return "";
	}
	function modeEnable(){
		var monthList = ["January","February","March","April","May","June","July","August","September","October","November","December"];
		var d = new Date()
		var month = monthList[d.getMonth()]
		document.getElementById("welcome").innerHTML = "Welcome to GamesHub - "+month
	}
</script>

<script>
const konamiCode2 = "up up down down left rght left right b a".split(" ")
const konamiCode = "a b a b up down up down left right left right".split(" ")
const keycodes = {
	"a": 65,
	"b": 66,
	"up": 38,
	"down": 40,
	"left": 37,
	"right": 39,
}
var codeIndex = 0
document.onkeydown = function(event){
	const keyCode = event.keyCode
	var reqKeycode = keycodes[konamiCode[codeIndex]]
	if(codeIndex>=konamiCode.length-1){window.location.href = "https://gameshub.dev/pirate"}
	if(keyCode==reqKeycode){
		codeIndex += 1
	} else{
		codeIndex = 0
	}
}
</script>

<script>
	fetch('https://gameshub-api.herokuapp.com/tokeninfo?token='+getCookie("accToken"),{})
	.then(response => response.text())
	.then(data => {
		console.log(JSON.parse(data))
		if(JSON.parse(data)=="COULDNT_FIND_TOKEN"){
			document.getElementById("currentAcc").href = "https://gameshub.dev/gamehubapi/signup"
			document.getElementById("currentAcc").innerHTML = "You are currently not signed in"
			document.getElementById("logout").style.display = "none"
		}
		else{
			document.getElementById("currentAcc").href = "https://gameshub.dev/gamehubapi/viewacc?username=" + JSON.parse(data).Username
			document.getElementById("currentAcc").innerHTML = "Currently signed in as " + JSON.parse(data).Username
			document.getElementById("tr1").style.display = "none"
			document.getElementById("tr2").style.display = "none"
		}
	})
</script>

<div id="chatMessages">
  <textarea id="noResize" maxlength="200"></textarea>
  <button id="sendChatBtn" onclick="sendChatMessage()">Send</button>
</div>
<style>
  #chatMessages{
    position: absolute;
    right: 10px;
    top: 10px;
    border: 1px solid black;
  }
  canvas{
		background-image: url("https://raw.githubusercontent.com/BoomBoomMushroom/GameHub/main/GamehubApi/images/GH_Background.png");
		background-repeat: no-repeat;
  	background-size: cover;
	}
  #noResize{
    resize: none;
  }
</style>

<script src="https://raw.githubusercontent.com/BoomBoomMushroom/GameHub/main/js_modules/HttpFetcher"></script>

<script>
document.onkeyup = keyUp;
document.onkeydown = keyDown;
function keyUp(e){keyboard[e.keyCode]=0;}
function keyDown(e){keyboard[e.keyCode]=1;}

let HOST = 'wss://gameshubhomegame.academyofcode1.repl.co'
let ws = new WebSocket(HOST);
let el;

const c = warzone
const ctx = c.getContext('2d')

const gameshubBackground = new Image()
gameshubBackground.src = "https://raw.githubusercontent.com/BoomBoomMushroom/GameHub/main/GamehubApi/images/GH_Background.png"

const keyboard = []
var toggleButtons = false

c.width = window.innerWidth
c.height = window.innerHeight
c.style.position = "absolute"
c.style.left = "0px"
c.style.top = "0px"

window.game = {
	playersArray: [],
}
// window.httpAddon

setInterval(()=>{
	// Movements
  // 87 - W, 38 - up
  // 83 - S, 40 - down
  // 68 - D, 39 ->
  // 65 - A, 37 <-
  // 32 - Space
  try{
    if(keyboard[87]==1||keyboard[38]==1){ws.send("packet-move-up")}
    if(keyboard[83]==1||keyboard[40]==1){ws.send("packet-move-down")}
    if(keyboard[68]==1||keyboard[39]==1){ws.send("packet-move-right")}
    if(keyboard[65]==1||keyboard[37]==1){ws.send("packet-move-left")}
    if(keyboard[32]==1){shoot();window.scroll(0,0)}
    if(keyboard[81]==1){
    	if(toggle){
      	toggleButtons=false
      } else{
      	toggleButtons = true
      }
    }
    render(window.game.playersArray)
    var bounds = {x:c.width,y:c.height}
    ws.send("packet-config-bounds-"+JSON.stringify(bounds))
  }catch(err){}
},100)
function date(){
	var t = Date()
  var ret = ""
  var splits = t.split(" ")
	ret += splits[0]+" "
	ret += splits[1]+" "
	ret += splits[2]+" "
	ret += splits[3]+" "
	ret += splits[4]+" "
  return ret
}
function onChatMessage(message,user){
	return
}
function sendChatMessage(){
	if(noResize.value!=""&&noResize.value.startsWith(" ")==false){
		ws.send("packet-message-"+noResize.value)
  	noResize.value = ""
  }
}

// Put all code up here, because for some reason it breaks down here

function heartbeat(){
	clearTimeout(this.pingTimeout);    
	this.pingTimeout = setTimeout(() => {
  	this.terminate()
	}, 30000);
}
ws.onmessage = function incoming(data) {
	msg = data.data
  var isJson = false
  try{msg=JSON.parse(msg);isJson=true}catch(err){}
  if(isJson){window.game.playersArray=msg}
  else if(msg.startsWith("data-msg")){
  	onChatMessage(msg.split("-")[2],msg.split("-")[3])
  } else if(msg.startsWith("id-")){
  	window.id = msg.split("-")[1]
  } else if(msg.startsWith("death")){
  	window.location.reload()
  }
  
  render(window.game.playersArray)
}
ws.on('open', heartbeat);
ws.on('ping', heartbeat);
ws.on('close', function close() {
	clearTimeout(this.pingTimeout);
})

function shoot(){
	ws.send("packet-shoot")
}
function render(players){
	ctx.clearRect(0,0,c.width,c.height)
  if(toggleButtons){
    	SinglePlayer.style.display = "none"
    	MultiPlayer.style.display = "none"
    	HolidayGames.style.display = "none"
    	DevBuilds.style.display = "none"
    } else{
    	SinglePlayer.style.display = "block"
    	MultiPlayer.style.display = "block"
    	HolidayGames.style.display = "block"
    	DevBuilds.style.display = "block"
    }
  players.forEach(player=>{
  	ctx.fillStyle = player.color
  	ctx.fillRect(player.x,player.y,5,5)
    player.playerData.shots.forEach(shot=>{
    	ctx.fillStyle = "#fcf803" // Yellow
    	ctx.fillRect(shot.x,shot.y,5,5)
    })
    if(player.id==window.id && player.died){
    	eval(player.playerData.deathFunct)
    }
    
    ctx.font = "10px Comic Sans MS";
    ctx.textAlign = "center";
  	ctx.fillStyle = player.color
    ctx.fillText(player.username,player.x,player.y-5)
    
    ctx.fillStyle = c.color
    if(player.playerData.currentMessage.timeLeft>0){
  		ctx.font = "10px Comic Sans MS";
      ctx.textAlign = "center";
    	ctx.fillText(player.playerData.currentMessage.message,player.x,player.y-20)
    }
  })
}
</script>
