<div id="login">
  <label for="pwd">Password: </label>
  <input id="pwd" type="password">
  <button onclick="render()" id="loginBtn">Login</button>
</div>

<div id="files" style="display:none;">
  <h1>Files:</h1>
</div>


<div id="svgs" style="display: none">
  <svg id="FolderSVG" aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-file-directory-fill hx_color-icon-directory"><path d="M1.75 1A1.75 1.75 0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0016 13.25v-8.5A1.75 1.75 0 0014.25 3H7.5a.25.25 0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"></path></svg>
  
  <svg id="FileSVG" aria-label="File" aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-file color-fg-muted"><path fill-rule="evenodd" d="M3.75 1.5a.25.25 0 00-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 00.25-.25V6h-2.75A1.75 1.75 0 019 4.25V1.5H3.75zm6.75.062V4.25c0 .138.112.25.25.25h2.688a.252.252 0 00-.011-.013l-2.914-2.914a.272.272 0 00-.013-.011zM2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0113.25 16h-9.5A1.75 1.75 0 012 14.25V1.75z"></path></svg>
</div>

<script>
const urlParams = new URLSearchParams(window.location.search);

const url = "https://GithubServer.academyofcode1.repl.co"
var repoName = urlParams.get('repoName') // "TabbyCat"
var path = urlParams.get('path')
if(path==null) path = ""

// Index Page
function render(){
	if(document.getElementById("pwd").value=="") return
  document.getElementById("loginBtn").disabled = true
  var pwd = document.getElementById("pwd").value
  
	fetch( url+"/getRepoFiles?password="+pwd+"&repoName="+repoName+"&path="+path )
  .then(response=>response.json())
  .then((data)=>{
  	data = JSON.parse(data)
  	document.getElementById("login").style.display = 'none'
    document.getElementById("files").style.display = 'block'
    
    console.log(data)
    
    for(var i=0;i<data.length;i++){
    	var file = data[i]
      
      var repoElementDiv = document.createElement("div")
      repoElementDiv.id = file.name+"-div"
      document.getElementById("files").appendChild(repoElementDiv)
      
      var iconId = ""
      if(file.type=="dir"){iconId = "FolderSVG"}
      else if(file.type=="file"){iconId = "FileSVG"}
      
      var repoElementIcon = document.getElementById(iconId).cloneNode(true);
      repoElementIcon.id = file.name + "-"+Math.random()
      document.getElementById(file.name+"-div").appendChild(repoElementIcon)
      
      var repoElement = document.createElement("a")
      repoElement.href = "https://gameshub.dev/github/file?repoName="+repoName+"&path="+path+"/"+file.name
      if(file.type=="dir"){
      	repoElement.href = "https://gameshub.dev/github/repo?repoName="+repoName+"&path="+path+"/"+file.name
      }
      repoElement.innerText = file.name
      document.getElementById(file.name+"-div").appendChild(repoElement)
      
      document.getElementById("files").appendChild( document.createElement("br") )
    }
  })
}
</script>
