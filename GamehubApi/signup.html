<div class="main">
    <p class="sign" align="center">Sign up</p>
    
    <p style="font-size:12px;" align="center" id="userLengthAlert">Username must be between 3-16 characters</p>
    <input id="usernameInput" class="un" type="text" align="center" placeholder="Username" maxlength="16">
    
    <p style="font-size:12px;" align="center" id="passwordAlert">Password must be longer than 8 characters</p>
    <input id="passwordInput" class="pass" type="password" align="center" placeholder="Password">
    <button class="submit" align="center" onclick='onSubmit()'>Sign up</button>
    <br>
    <br>
    <center>
      <input type="checkbox" id="rememberMe" name="rememberMe">
      <label for="rememberMe">Remember Me</label>
    </center>
    <!--
    <p class="forgot" align="center"><a href="#">Forgot Password?</a></p>
    -->
  </div>
</body>

<form action="https://gameshub-api.herokuapp.com/login" method="get" id="signin"></form>

<script src="https://www.google.com/recaptcha/api.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
      let HOST = 'wss://multi-socket-ms.herokuapp.com/'
      let ws = new WebSocket(HOST);

      function heartbeat(){
        clearTimeout(this.pingTimeout);

        this.pingTimeout = setTimeout(() => {
              this.terminate()
            }, 30000);
      }

      ws.onmessage = function incoming(data) {
        var msg = data.data.text();
        msg.then(m=>{
          if(recentActions.length>0){
          	if (recentActions[0]=="Signin"){
            	if (m!=="INVALID_ACCOUNT_TOKEN"){
                if(document.getElementById("rememberMe").checked===true){
                  setCookie("accToken",m,365*10)
                  recentActions.shift()
                } else{
                  setCookie("accToken",m,1)
                  recentActions.shift()
                }
                window.location.replace("https://gameshub.netlify.app")
                console.log("Token Got: "+m)
              } else{
              	console.log(m)
              	alert("Invailid Username or Password!")
              }
            }
            else if(recentActions[0]=="Signup"){
            	console.log("Signup message returned : "+m)
            	sendMsg('gameshub-api.herokuapp.com;/login?username='+inputUsername+'&password='+inputPassword+';GET');
              console.log('gameshub-api.herokuapp.com;/login?username='+inputUsername+'&password='+inputPassword+';GET')
              recentActions.shift()
              recentActions.push("Signin")
            }
          }
          //console.log(m)
        })
      }

      ws.on('open', heartbeat);
      ws.on('ping', heartbeat);
      ws.on('close', function close() {
        clearTimeout(this.pingTimeout);
      })
  </script>
<style>
        body {
        background-color: #F3EBF6;
        font-family: 'Ubuntu', sans-serif;
    }
    
    .main {
        background-color: #FFFFFF;
        width: 400px;
        height: 400px;
        margin: 7em auto;
        border-radius: 1.5em;
        box-shadow: 0px 11px 35px 2px rgba(0, 0, 0, 0.14);
    }
    
    .sign {
        padding-top: 40px;
        color: #8C55AA;
        font-family: 'Ubuntu', sans-serif;
        font-weight: bold;
        font-size: 23px;
    }
    
    .un {
    width: 76%;
    color: rgb(38, 50, 56);
    font-weight: 700;
    font-size: 14px;
    letter-spacing: 1px;
    background: rgba(136, 126, 126, 0.04);
    padding: 10px 20px;
    border: none;
    border-radius: 20px;
    outline: none;
    box-sizing: border-box;
    border: 2px solid rgba(0, 0, 0, 0.02);
    margin-bottom: 50px;
    margin-left: 46px;
    text-align: center;
    margin-bottom: 27px;
    font-family: 'Ubuntu', sans-serif;
    }
    
    form.form1 {
        padding-top: 40px;
    }
    
    .pass {
            width: 76%;
    color: rgb(38, 50, 56);
    font-weight: 700;
    font-size: 14px;
    letter-spacing: 1px;
    background: rgba(136, 126, 126, 0.04);
    padding: 10px 20px;
    border: none;
    border-radius: 20px;
    outline: none;
    box-sizing: border-box;
    border: 2px solid rgba(0, 0, 0, 0.02);
    margin-bottom: 50px;
    margin-left: 46px;
    text-align: center;
    margin-bottom: 27px;
    font-family: 'Ubuntu', sans-serif;
    }
    
   
    .un:focus, .pass:focus {
        border: 2px solid rgba(0, 0, 0, 0.18) !important;
        
    }
    
    .submit {
      cursor: pointer;
        border-radius: 5em;
        color: #fff;
        background: linear-gradient(to right, #9C27B0, #E040FB);
        border: 0;
        padding-left: 40px;
        padding-right: 40px;
        padding-bottom: 10px;
        padding-top: 10px;
        font-family: 'Ubuntu', sans-serif;
        margin-left: 35%;
        font-size: 13px;
        box-shadow: 0 0 20px 1px rgba(0, 0, 0, 0.04);
    }
    
    .forgot {
        text-shadow: 0px 0px 3px rgba(117, 117, 117, 0.12);
        color: #E1BEE7;
        padding-top: 15px;
    }
    
    a {
        text-shadow: 0px 0px 3px rgba(117, 117, 117, 0.12);
        color: #E1BEE7;
        text-decoration: none
    }
    
    @media (max-width: 600px) {
        .main {
            border-radius: 0px;
        }
    }
</style>

    <script type="text/javascript">//<![CDATA[


const usernameInput = document.getElementById("usernameInput")
const passwordInput = document.getElementById("passwordInput")

var recentActions = []
var signedIn = false

function onSubmit() {
  inputUsername = usernameInput.value
  inputPassword = passwordInput.value
  if (inputUsername.length >= 3 && inputUsername.length <= 16 && inputPassword.length >= 8) {
    sendMsg('gameshub-api.herokuapp.com;/signup?username=' + inputUsername + '&password=' + inputPassword + ';GET');
    console.log('gameshub-api.herokuapp.com;/signup?username=' + inputUsername + '&password=' + inputPassword + ';GET')
    recentActions.push("Signup")
  }
}

// Cookie Functions
function setCookie(cname, cvalue, exdays) {
  const d = new Date();
  d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
  let expires = "expires=" + d.toUTCString();
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

function getCookie(cname) {
  let name = cname + "=";
  let decodedCookie = decodeURIComponent(document.cookie);
  let ca = decodedCookie.split(';');
  for (let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}

// Websocket
window.onopen = sendReason()

function sendReason() {
  var time = setInterval(() => {
    try {
      ws.send('REASON-Gameshub_Api')
      ws.send('username-undefined')
      clearInterval(time)
    } catch (err) {
      // console.log('ERROR',err)
    }
  }, 50)
}

function sendMsg(msg) {
  ws.send(msg)
}



  //]]></script>

  <script>
    // tell the embed parent frame the height of the content
    if (window.parent && window.parent.parent){
      window.parent.parent.postMessage(["resultsFrame", {
        height: document.body.getBoundingClientRect().height,
        slug: "kjn8d74c"
      }], "*")
    }

    // always overwrite window.name, in case users try to set it manually
    window.name = "result"
  </script>

    <script>
      let allLines = []

      window.addEventListener("message", (message) => {
        if (message.data.console){
          let insert = document.querySelector("#insert")
          allLines.push(message.data.console.payload)
          insert.innerHTML = allLines.join(";\r")

          let result = eval.call(null, message.data.console.payload)
          if (result !== undefined){
            console.log(result)
          }
        }
      })
    </script>
