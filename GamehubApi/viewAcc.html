<img id="loadingWheel" src="https://media.tenor.com/On7kvXhzml4AAAAj/loading-gif.gif">

<img id="pfp" src="" style="border:1px solid black;background-color:white;border-radius:10%;" width=150 height=150>
<p id="accountUsername">{USERNAME}</p>
<em><p id="accountUUID">{UUID}</p></em>

<br>

<div id="pastUsernames">
  <p id="usernamesHeader" style="display:none;">Past Usernames:</p>
  <ul id="puList"></ul>
</div>

<div id="accountbadges">
  <p id="badgesHeader" style="display:none;">Badges:</p>
</div>

<div id="accountFriends">
  <p id="friendsHeader" style="display:none;">Friends:</p>
</div>

<div id="accountAdvancements">
  <p id="advancementsHeader" style="display:none;">Advancements:</p>
</div>

<style>
.darkmode_text{
  color: white
}
.darkmode_body{
  background: "#2C2F33"
}

#accountUsername{
  font-size: 20px
}
#accountUUID{
  font-size: 15px
}
</style>
<script>
var recentActions = []

// Starter
const firstVar = window.location.href.split("?")[1] || null
const placeholderAdvancements = []

function addCommas(x) {
	var parts = x.toString().split(".");
  parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  return parts.join(".");
}

const getMeta = (url, cb) => {
  const img = new Image();
  img.onload = () => cb(null, img);
  img.onerror = (err) => cb(err);
  img.src = url;
};
	
function loadData(m){
  document.getElementById("loadingWheel").remove()
  
	m = JSON.parse(m)
  try{
  	var myDate = new Date(m.AccountCreationTime*1000)
    if(m.ProfilePicture!=""){
	var url = m.ProfilePicture;
      getMeta(url, (err, img) => {
	var ratio = img.naturalHeight / img.naturalWidth;
	document.getElementById("pfp").height = document.getElementById("pfp").width * ratio;
      });
      document.getElementById("pfp").src = m.ProfilePicture
    }
    else{
	    document.getElementById("pfp").src = "https://avatars.dicebear.com/api/identicon/"+m.Username+".svg"
    }
    document.getElementById("accountUsername").innerHTML = m.Username + " - Money: " + addCommas(m.GameshubData.Money) +" - " + myDate.toLocaleString().split(",")[0]
  }
  catch(err){
	  if(m.ProfilePicture!=""){
      document.getElementById("pfp").src = m.ProfilePicture
    }
    else{
	    document.getElementById("pfp").src = "https://avatars.dicebear.com/api/identicon/"+m.Username+".svg"
    }
    document.getElementById("accountUsername").innerHTML = m.Username + " - Money: " + m.GameshubData.Money +" - Invailid Date"
  }
  document.getElementById("accountUUID").innerHTML = "UUID: "+m.UUID
  
  try{
    // Past Usernames loader
    if(m.UsernameHistory.length>0){
      document.getElementById("usernamesHeader").style.display = "block"
      for(var i=0;i<m.UsernameHistory.length;i++){
        var currentName = m.UsernameHistory[i]
        document.getElementById("puList").innerHTML += currentName
      }
    }
  } catch(e){}
  
  try{
    // Badges loader
    if(m.Badges.length>0){
      document.getElementById("badgesHeader").style.display = "block"
      for(var i=0;i<m.Badges.length;i++){
        var currentBadge = m.Badges[i]
        document.getElementById("accountbadges").innerHTML += currentBadge.html
      }
    }
  } catch(e){}
  
  try{
    // Friends loader
    if(m.Friends.length>0){
      document.getElementById("friendsHeader").style.display = "block"
      for(var i=0;i<m.Friends.length;i++){
        var currentFriend = m.Friends[i]
        var newEle = document.createElement("p")
        newEle.innerHTML = JSON.stringify(currentFriend)
        document.getElementById("accountFriends").appendChild(newEle)

        var brEle = document.createElement("br")
        document.getElementById("advancementsHeader").appendChild(brEle)
      }
    }
  } catch(e){}
  // Advancement loader
  var advancements = m.GameshubData.Advancements
  if(advancements.length>0){
  	document.getElementById("advancementsHeader").style.display = "block"
    for(var i=0;i<advancements.length;i++){
      fetch("https://Gameshub-API.boomboommushroom.repl.co/getadvancement?id="+advancements[i])
      .then(response=>response.text())
			.then(d=>{
      	var CurrentAdv = JSON.parse(d)
        if(CurrentAdv.img!="None"){
          document.getElementById("advancementsHeader").innerHTML += "<br><img src='"+CurrentAdv.img+"'></img><strong>"+CurrentAdv.header+"</strong> "+CurrentAdv.desc
        } else{
          document.getElementById("advancementsHeader").innerHTML += "<br><strong>"+CurrentAdv.header+"</strong> "+CurrentAdv.desc
        }
      })
    }
  }
}


function loader(){

	function setCookie(cname, cvalue, exdays){
    const d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    let expires = "expires="+d.toUTCString();
    document.cookie = cname+"="+cvalue+";"+expires+";path=/";
  }
  function getCookie(cname){
    let name = cname + "=";
    let decodedCookie = decodeURIComponent(document.cookie);
    let ca = decodedCookie.split(';');
    for (let i=0; i<ca.length;i++){
      let c = ca[i];
      while (c.charAt(0)==' '){
        c = c.substring(1);
      }
      if(c.indexOf(name)==0){
        return c.substring(name.length,c.length);
      }
    }
    return "";
  }
  function getDarkmode(cookieName){
  	return true
    if(getCookie(cookieName)==""){
    	return false
    }
    else{
    	return true
    }
  }
  darkmode = true // getDarkmode("theme")
  
  if(darkmode==true){
    var darkmodeColor = "#2C2F33"
    paragraphs = document.getElementsByTagName("p")
    document.body.style.background = darkmodeColor
    for(var x=0;x<paragraphs.length;x++){
      para = paragraphs[x]
      para.style.color = "#ffffff"
      // para.classList.add("darkmode_text")
    }
  }
}
</script>
<script>
  if(firstVar.split("=")[0]=="q"){
    fetch('https://Gameshub-API.boomboommushroom.repl.co/getaccount?uuid='+firstVar.split("=")[1],{})
    .then(response => response.text())
    .then(data => {
      // console.log(JSON.parse(data))
      loadData(data)
      //loadData(JSON.parse(data))
    })
  }
</script>
