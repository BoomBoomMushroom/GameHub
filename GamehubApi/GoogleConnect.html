<html>
  <head>
    <style>
    body{
      background-color: #333333;
      color: white;
      text-align: center !important;
      margin: auto !important;
    }
    </style>
  </head>
  <body>
      <h1>Google Account Connector</h1>
      <h4>Connect your Google account with your GamesHub account!</h4>
      <button style="color:red" onclick="disconnectGoogle()">Disconnect Google Account</button>
      <br><br>
  
      <script src="https://accounts.google.com/gsi/client" async defer></script>      
      <script src="https://accounts.google.com/gsi/client" async defer></script>
      <script src="https://unpkg.com/jwt-decode/build/jwt-decode.js"></script>
      <script>
      	function getCookie(cname){
          let name = cname + "=";
          let decodedCookie = decodeURIComponent(document.cookie);
          let ca = decodedCookie.split(';');
          for(let i = 0; i <ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) == ' ') {
              c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
              return c.substring(name.length, c.length);
            }
          }
          return "";
        }
      
      	function disconnectGoogle(){
      		let params = "?token="+getCookie("accToken")
          let url = "https://Gameshub-API.boomboommushroom.repl.co/disconnectGoogle"
          fetch(url + params)
          .then(d=>d.json())
          .then(data=>{
            alert(data)
            console.log(data)
          })
        }
      
        function handleCredentialResponse(response) {
        	//let responsePayload = decodeJwtResponse(response.credential);
					let responsePayload = jwt_decode(response.credential);
          //console.log(responsePayload)
          var token = getCookie("accToken")
          let params = "?token="+token+"&googleToken="+response.credential
          let url = "https://Gameshub-API.boomboommushroom.repl.co/connectGoogle"
          fetch(url + params)
          .then(d=>d.json())
          .then(data=>{
            alert(data)
            console.log(data)
          })
          
          console.log("Encoded JWT ID token: " + response.credential);
        }
        window.onload = function () {
          google.accounts.id.initialize({
            client_id: "1014890641437-4l37tqeqt3p542f4scnmoos3rn3669i0.apps.googleusercontent.com",
            callback: handleCredentialResponse
          });
          google.accounts.id.disableAutoSelect()

          google.accounts.id.renderButton(
            document.getElementById("buttonDiv"),
            { theme: "outline", size: "large" }  // customization attributes
          );
          //google.accounts.id.prompt(); // also display the One Tap dialog
        }
    </script>
    <div id="buttonDiv"></div> 
  </body>
</html>
