<h2>Gameshub Shop!</h2>
<p id="money" style="position:absolute;right:10px;top:0px;">0G</p>

<img id="loadingWheel" src="https://media.tenor.com/On7kvXhzml4AAAAj/loading-gif.gif">

<script>
function httpFetchJSON(url,callback,onError){
	fetch(url)
  .then(response=>response.json())
  .then(data=>callback(data))
  .catch(error=>onError(error))
}
function httpFetchText(url,callback,onError){
	fetch(url)
  .then(response=>response.text())
  .then(data=>callback(data))
  .catch(error=>onError(error))
}
</script>
<script>
	function setCookie(cname, cvalue, exdays){
	  const d = new Date();
	  d.setTime(d.getTime() + (exdays*24*60*60*1000));
	  let expires = "expires="+d.toUTCString();
	  document.cookie = cname+"="+cvalue+";"+expires+";path=/";
	}
	function getCookie(cname){
	  let name = cname + "=";
	  let decodedCookie = decodeURIComponent(document.cookie);
	  let ca = decodedCookie.split(';');
	  for (let i=0; i<ca.length;i++){
		let c = ca[i];
	    while (c.charAt(0)==' '){
			c = c.substring(1);
	    }
	    if(c.indexOf(name)==0){
			return c.substring(name.length,c.length);
	    }
	  }
	  return "";
	}
</script>
<script>
var account

// https://Gameshub-API.academyofcode1.repl.co/getshop
httpFetchJSON('https://Gameshub-API.academyofcode1.repl.co/getshop',shopLoad,()=>{})

httpFetchJSON('https://Gameshub-API.academyofcode1.repl.co/tokeninfo?token='+getCookie('accToken'),(d)=>{
	console.log(d)
	httpFetchJSON('https://Gameshub-API.academyofcode1.repl.co/getaccount?username='+d.Username,(x)=>{
    console.log(x)
    money.innerHTML = addCommas( x.GameshubData.Money )+"G"
  },()=>{})
},()=>{})

function addCommas(x) {
	var parts = x.toString().split(".");
  parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  return parts.join(".");
}

function buy(id){
	console.log("demo buying item with id of - "+id)
  var token = getCookie("accToken")
  // https://Gameshub-API.academyofcode1.repl.co/getshop
  httpFetchText('https://Gameshub-API.academyofcode1.repl.co/buy?id='+id+"&token="+token,
  (d)=>{
  	alert(d)
    window.reload()
  },
  ()=>{})
}
function shopLoad(d){
	console.log(d)
	d.forEach(item=>{
		var itemPage = document.createElement("BUTTON")
		itemPage.id = item.id
		itemPage.addEventListener('click',()=>{buy(item.id);})
		document.body.appendChild(itemPage)
		
		var itemName = document.createElement("H3")
		itemName.innerText = item.name + " - " +addCommas(item.price)+"G"
		itemPage.appendChild(itemName)
		
		var itemDesc = document.createElement("P")
		itemDesc.innerText = item.description
		itemPage.appendChild(itemDesc)
	})
	document.removeChild( document.getElementById("loadingWheel") )
}
</script>
